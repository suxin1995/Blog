## airflow传参

#### 一.通过API和airflow交互

1. GET方法获取指定<DAG_ID>下的指定<TASK_ID>信息

```python
http://<WEBSERVER>:<PORT>/api/experimental/dags/<DAG_ID>/tasks/<TASK_ID>   #returns info for a task (GET).
```

```
# 接口返回的信息主要包括：
{
    "adhoc": "False",
    "depends_on_past": "False",
    "email": "['XXX@XXX.com']",
    "email_on_failure": "True",
    "email_on_retry": "True",
    "end_date": "None",
    "execution_timeout": "None",
    "max_retry_delay": "None",
    "on_failure_callback": "None",
    "on_retry_callback": "None",
    "on_success_callback": "None",
    "op_args": "[]",
    "op_kwargs": "{}",
    "owner": "XXX",
    "params": "{}",
    "pool": "None",
    "priority_weight": "1",
    "provide_context": "True",
    "python_callable": "<function get_params at 0x7f2e156691b8>",
    "queue": "3708",
    "resources": "{'disk': {'_qty': 512, '_units_str': 'MB', '_name': 'Disk'}, 'gpus': {'_qty': 0, '_units_str': 'gpu(s)', '_name': 'GPU'}, 'ram': {'_qty': 512, '_units_str': 'MB', '_name': 'RAM'}, 'cpus': {'_qty': 1, '_units_str': 'core(s)', '_name': 'CPU'}}",
    "retries": "1",
    "retry_delay": "0:05:00",
    "retry_exponential_backoff": "False",
    "run_as_user": "XXX",
    "sla": "None",
    "start_date": "2018-07-09 00:00:00",
    "task_id": "get_params",
    "templates_dict": "None",
    "trigger_rule": "all_success",
    "wait_for_downstream": "False"
}
```

2. POST方法运行指定的<DAG_ID>

```python
http://<WEBSERVER>:<PORT>/api/experimental/dags/<DAG_ID>/dag_runs   #creates a dag_run for a given dag id (POST).
```

```python
# 传入自定义参数给DAG
{
    "conf": "{\"id\":1, \"start_time\":\"2018-01-01 00:00:00\", \"end_time\":\"2018-10-31 23:59:59\"}"
}
# 通过以上方式传入的参数会存放在 ‘dag_run’的conf属性中，因此在DAG中获取参数方式：
def get_params(**kwargs):
    id=kwargs.get('dag_run').conf.get('id')
    start_time=kwargs.get('dag_run').conf.get('start_time')
    end_time=kwargs.get('dag_run').conf.get('end_time')
```



## 二.通过命令行启动DAG时传参

```python
airflow trigger_dag <dag_id> -c '{"id":1, "start_time":"2018-01-01 00:00:00", "end_time":"2018-10-31 23:59:59"}'
```

